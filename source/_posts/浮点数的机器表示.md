---
title: 浮点数的机器表示
date: 2020-09-29 22:01:08
tags:
---

## IEEE的浮点数表示

计算机采用`IEEE 754`标准对浮点数进行编码。

`IEEE 754`标准将浮点数分为3部分：

- 符号（sign）。`s = 1`是负数，反之是正数
- 尾数（significand）。`M`是一个二进制小数
- 阶码（exponent）。`E`的作用是对浮点数加权，权重是2的`E`次幂

<!--more-->

浮点数的位表示因此被分为3个字段，分别对这些值进行编码：

- 1个单独的符号位`s`直接编码符号
- k位阶码字段`exp`编码阶码`E`
- n位小数字段`frac`编码尾数`M`，依赖于阶码字段的值是否为0

| 浮点格式   | s   | exp  | frac |
|------------|-----|------|------|
| 单精度32位 | 1位 | 8位  | 23位 |
| 双精度64位 | 1位 | 11位 | 52位 |

根据`exp`的值，被编码的值可分为3种不同的情况

### 规格化的值

当`exp`的位模式不全为1或0时，属于这种情况。

此时阶码字段被解释为以**偏置（bias）形式表示的有符号整数**，即`E = e - Bias`，其中`e`为`exp`字段被解释为无符号数时的值，而`Bias`是一个与`exp`字段长度有关的固定值，等于`2^(k-1)-1`（单精度时是127，双精度是1023）

`frac`为小数字段，表示的是小数`f`。尾数值`M = 1 + f`。这种表示方式被称为**隐含的以1开头（implied leading 1）的表示**。

### 非规格化的值

当阶码域全为0时，所表示的数是非规格化的数。在这种情况下，阶码值是`E = 1 - Bias`，尾数`M = f`，不包含隐含的开头1。

非规格化数有2个用途：

- 提供了一种表示0的方法。需要注意的是，这种表示方法会出现`+0`和`-0`。
- 表示那些非常接近0的数，这种属性称为**逐渐溢出（gradual overflow）**。

### 特殊值

当阶码全为1时的数为特殊值。此时当小数域为0时表示无穷；若小数域非0表示`NaN (Not a Number)`

如果将所有固定位长可表示的浮点数标注在数轴上，可以发现的一个现象是——可表示的数并非均匀分布的，越靠近原点处越稠密。

值得注意的是**规格化浮点数**和**非规格化浮点数**这样的编码方式保证了浮点数的进位在编码上的体现是平滑的。

## 舍入（rounding）

常用的舍入方式有4种：

- 向偶数舍入（IEEE 754默认使用的摄入方式）
- 向零舍入
- 向下舍入
- 向上舍入

在二进制数舍入时注意`halfway`值，即被舍掉部分为`100...`（1后面全是0）的值。当被舍掉部分大于`halfway`值，则进位；小于则不进位；等于时则需要向偶数舍入，即若进位后舍入的值为偶数则进位，否则不进位。

## 浮点运算

当浮点数相乘时，符号位相与，阶码位相加，尾数位相乘。

相乘的结果可能需要进行如下修正：

- 如果`M >= 2`，`M`右移并且增加阶码位
- 如果阶码位溢出，则结果为无穷
- 对`M`进行舍入操作

浮点数的运算具备以下特征

- 满足交换律
- 不满足结合律
- 不满足分配律
