---
title: 软件分析技术-PKU
date: 2020-12-03 22:33:34
tags:
---

## 录播视频

[2020年秋季课程](https://liveclass.org.cn/cloudCourse/#/courseDetail/8mI06L2eRqk8GcsW)

<!--more-->

## 1

### 莱斯定理

> 我们可以把任意程序看成一个从输入到输出上的函数（输入输出对的集合），该函数描述了程序的行为
> 关于该函数/集合的任何非平凡属性，都不存在可以检查该属性的通用算法
>
> - 平凡属性：要么对全体程序都为真，要么对全体程序都为假
> - 非平凡属性：不是平凡的所有属性
> - 关于程序行为：即能定义在函数上的属性

Q：如何使用莱斯定理快速判断可判定性？
A：如果关于程序的某命题的输入输出可以写成函数的关系，则该命题不可判定。如
> 给定程序和输入，程序是否会抛出异常？
>
> 可定义为*f(i) = EXCEPT*

### 非判定问题

近似分析，must分析和may分析的定义取决于问题性质。

假设正确答案是一个集合`S`，那么

- must分析返回的集合是`S`的子集
- may分析返回的集合是`S`的超集

must与may的区分并不严格，可以相互转换

如

- 软件测试属于must分析。因为测出来的一定是bug，但程序可能还存在未测试出的bug

### 健壮性 soundness

健壮性往往对应与must分析和may分析中的一个

健壮性的反面有时称为完整性completeness。

如果健壮性对应must analysis，则完整性对应may analysis

### 求近似解的基本方法

莱斯定理并不意味着不能得到近似解

#### 抽象

用抽象的符号代表集合，用符号的运算代替具体值的集合

基于抽象解释的程序分析：

- 数据流分析
- 过程间分析
- 指针分析
- 抽象解释
- 抽象解释自动化

#### 搜索

基于约束求解的程序分析：

- SAT
- SMT
- 霍尔逻辑
- 符号执行

## 2

### 数据流分析

忽略条件判断，认为所有分支都有可能到达。

程序可看作状态（数据）和转移（控制信息）2部分，因为转移被忽略，只关注状态变化，故为数据流分析

#### 符号分析

Q：如何知道程序有哪些可能的路径？
A：忽略条件判断

Q：如何遍历所有可能的路径
A：在控制流汇合处合并

##### 算法

[![符号分析算法](https://z3.ax1x.com/2021/08/16/fffkHf.jpg)](https://imgtu.com/i/fffkHf)

###### 算法性质

- 是否安全？
- 保证终止？
- 一定合流？
  - 有多个结点可更新的时候，是否无论先更新哪个结点最后都会到达同样的结果？

终止+合流=收敛

#### 小结

给出一条程序路径上的分析方案和不同路径上的结果合并方案

2种近似方案：

- 忽略分支
- 在控制流汇合处合并状态

#### 数据流分析——活跃变量分析

> 活跃变量：给定程序某语句s和变量v，若s执行前保存在v中的值在后续执行中还会被读取，则为活跃变量

##### 算法

[![活跃变量分析算法](https://z3.ax1x.com/2021/08/17/f5Lbm8.jpg)](https://imgtu.com/i/f5Lbm8)

#### 半格

[![半格](https://z3.ax1x.com/2021/08/17/f5XS4H.jpg)](https://imgtu.com/i/f5XS4H)

#### 数据流分析单调框架

目标：通过配置框架参数，导出各种类型的算法，保证其安全性、终止性、收敛性

需要抽象的内容：

- 不同算法在结点上附加的值不同，需要接口
- 不同算法的结点转换函数不同，需要接口

框架：

- 一个控制流图$(V, E)$
- 一个有限高度的半格$(S,\sqcap)$
- 一个entry的初值$I$
- 一组单调函数，对任意$v \in V-entry$存在一个单调函数$f_v$

逆向分析变换控制流图方向再应用单调框架即可

应用单调框架设计一个数据流分析包含：

- 设计每个结点附加值的定义域
- 设计交汇函数
- 设计从语句导出结点变换函数的方法
- 入口结点的初值

需要证明：

- 单条路径上变换函数保证安全性
- 交汇函数对多条路径的合并方式保证安全性
- 交汇函数形成一个半格
- 半格高度有限
- 变换函数单调

## 3

### 最大下界

半格的任意子集都有最大下界

### 数据流分析的安全性

[![数据流分析的安全性定义](https://z3.ax1x.com/2021/08/19/fq53Mq.jpg)](https://imgtu.com/i/fq53Mq)

[![数据流分析的安全性证明](https://z3.ax1x.com/2021/08/19/fq5lzn.jpg)](https://imgtu.com/i/fq5lzn)

### 数据流分析的分配性

[![数据流分析的分配性](https://z3.ax1x.com/2021/08/19/fq5fWd.jpg)](https://imgtu.com/i/fq5fWd)

[![数据流分析的分配性2](https://z3.ax1x.com/2021/08/19/fq5Iyt.jpg)](https://imgtu.com/i/fq5Iyt)

### 数据流分析的收敛性

[![数据流分析的收敛性](https://z3.ax1x.com/2021/08/19/fq5OYQ.jpg)](https://imgtu.com/i/fq5OYQ)

### widening

#### 基础widening

设计一个新的函数，多映射一次。

如设定一个有限集合，降低半格的高度，如区间分析中设定有限个区间参考值。

#### 一般widening

参考更新前和更新后的值来猜测最终收敛的值。如区间分析中，若上界更新后变大，则直接将上界设为$+\infty$

“一般widening”保证安全性，但收敛性不好证明，而且widening有可能不收敛。

### narrowing

使用原始转换函数widening修正widening的结果

#### narrowing的安全性

[![narrowing的安全性](https://z3.ax1x.com/2021/08/26/hn4XtI.jpg)](https://imgtu.com/i/hn4XtI)

narrowing不保证收敛，且收敛不容易证明

## 4

### 多角度理解数据流分析

#### 逻辑规则视角

## 5

### 程序分析的分类——敏感性

程序分析中考虑的信息通常用敏感性表示。

### 给数据流分析添加基本路径敏感性

给每条分支添加assert语句，然后设置assert的转换函数。

优点：

- 完全兼容已有的数据流分析框架

缺点：

- 很多类型无法写出过滤函数
- 很多情况无法精确判断
- 无法分路径输出结果，不能回答“什么输入会导致除0错误”

符号执行技术与数据流分析互补

### 静态单赋值和稀疏分析

#### Def-Use关系

给定变量x，如果结点A可能改变x的值，结点B可能使用结点A改变后的x的值，则结点A和结点B存在Def-Use关系。

这样，只按Def-Use边传递抽象值，图变成稀疏图。

#### 性质

- 基于may分析
- sound
- precise

#### 问题1

通过reaching definition获取Def-Use关系，但reaching definition不快

#### 问题2

如果可能的定义多，图中边可能增加。

#### 静态单赋值 Single Static Assignment

每个变量只被赋值一次。这样直接就形成Def-Use关系，并且静态单赋值存在高效算法，且边数不会平方增长。

##### 静态单赋值 vs 流非敏感分析

静态单赋值形式上的流非敏感分析与流敏感分析等价。

基于静态单赋值形式的分析通常又称为稀疏分析Sparse Analysis

##### 实践中的稀疏分析

不能正确处理包含指针的操作。

解决方法：

- 把内存分为2组，部分SSA
- java只对堆上使用
- C区分是否被取过地址

在处理C语言时，LLVM的IR使用了SSA的形式。

## To be continue

后面在课件上直接进行笔记。
